
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../architecture/">
      
      
        <link rel="next" href="../api_docs/python/tfma/">
      
      
      <link rel="icon" href="../images/tf_full_color_primary_icon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>FAQ - TensorFlow Model Analysis</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tensorflow-model-analysis-frequently-asked-questions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TensorFlow Model Analysis" class="md-header__button md-logo" aria-label="TensorFlow Model Analysis" data-md-component="logo">
      
  <img src="../images/tf_full_color_primary_icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TensorFlow Model Analysis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FAQ
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/tensorflow/model-analysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    model-analysis
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TensorFlow Model Analysis" class="md-nav__button md-logo" aria-label="TensorFlow Model Analysis" data-md-component="logo">
      
  <img src="../images/tf_full_color_primary_icon.svg" alt="logo">

    </a>
    TensorFlow Model Analysis
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tensorflow/model-analysis" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    model-analysis
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Improving Model Quality
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics and Plots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualizations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualizations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_validations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Validations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://tensorflow.github.io/tfx/guide/fairness_indicators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Fairness Indicators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://tensorflow.github.io/fairness-indicators/tutorials/Fairness_Indicators_Pandas_Case_Study/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Fairness Indicators with Pandas DataFrames
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    <span class="md-ellipsis">
      General
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is-an-evalsavedmodel-still-required" class="md-nav__link">
    <span class="md-ellipsis">
      Is an EvalSavedModel still required?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-tfma-work-with-both-in-graph-metrics-and-external-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Can TFMA work with both in-graph metrics and external metrics?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-model-types-are-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What model types are supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-native-keras-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a native keras based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-generic-tf2-signatures-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a generic TF2 signatures based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-an-estimator-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with an estimator based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-keras-model-to-estimator-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a keras model-to-estimator based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-tfrecord-and-tfexample" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (TFRecord and tf.Example)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-pddataframe" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (pd.DataFrame)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-types-of-metrics-are-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What types of metrics are supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-metrics-from-multi-output-models-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are metrics from multi-output models supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-metrics-from-multiple-models-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are metrics from multiple-models supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-the-metric-settings-name-etc-be-customized" class="md-nav__link">
    <span class="md-ellipsis">
      Can the metric settings (name, etc) be customized?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-custom-metrics-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are custom metrics supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-types-of-metrics-are-not-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What types of metrics are not supported?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-ons" class="md-nav__link">
    <span class="md-ellipsis">
      Add-ons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add-ons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-i-use-tfma-to-evaluate-fairness-or-bias-in-my-model" class="md-nav__link">
    <span class="md-ellipsis">
      Can I use TFMA to evaluate fairness or bias in my model?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-if-i-need-more-customization" class="md-nav__link">
    <span class="md-ellipsis">
      What if I need more customization?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-debugging-and-getting-help" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting, debugging, and getting help
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting, debugging, and getting help">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-dont-multiclassconfusionmatrix-metrics-match-binarized-confusionmatrix-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Why don't MultiClassConfusionMatrix metrics match binarized ConfusionMatrix metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-my-precision1-and-recall1-metrics-have-the-same-value" class="md-nav__link">
    <span class="md-ellipsis">
      Why do my precision@1 and recall@1 metrics have the same value?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-are-my-mean_label-and-mean_prediction-metrics-always-05" class="md-nav__link">
    <span class="md-ellipsis">
      Why are my mean_label and mean_prediction metrics always 0.5?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-interpret-the-multilabelconfusionmatrixplot" class="md-nav__link">
    <span class="md-ellipsis">
      How to interpret the MultiLabelConfusionMatrixPlot?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-i-get-an-error-about-prediction-key-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      Why do I get an error about prediction key not found?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.constants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-contrib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.contrib
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-evaluators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.evaluators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-experimental/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.experimental 🧪
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-extractors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.extractors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-post_export_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.post_export_metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.sdk
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-validators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.validators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-version/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.version
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-view/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.view
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api_docs/python/tfma-writers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tfma.writers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    <span class="md-ellipsis">
      General
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is-an-evalsavedmodel-still-required" class="md-nav__link">
    <span class="md-ellipsis">
      Is an EvalSavedModel still required?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-tfma-work-with-both-in-graph-metrics-and-external-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Can TFMA work with both in-graph metrics and external metrics?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-model-types-are-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What model types are supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-native-keras-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a native keras based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-generic-tf2-signatures-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a generic TF2 signatures based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-an-estimator-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with an estimator based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-a-keras-model-to-estimator-based-model" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with a keras model-to-estimator based model?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-tfrecord-and-tfexample" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (TFRecord and tf.Example)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-pddataframe" class="md-nav__link">
    <span class="md-ellipsis">
      How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (pd.DataFrame)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-types-of-metrics-are-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What types of metrics are supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-metrics-from-multi-output-models-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are metrics from multi-output models supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-metrics-from-multiple-models-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are metrics from multiple-models supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#can-the-metric-settings-name-etc-be-customized" class="md-nav__link">
    <span class="md-ellipsis">
      Can the metric settings (name, etc) be customized?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#are-custom-metrics-supported" class="md-nav__link">
    <span class="md-ellipsis">
      Are custom metrics supported?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-types-of-metrics-are-not-supported" class="md-nav__link">
    <span class="md-ellipsis">
      What types of metrics are not supported?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-ons" class="md-nav__link">
    <span class="md-ellipsis">
      Add-ons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add-ons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#can-i-use-tfma-to-evaluate-fairness-or-bias-in-my-model" class="md-nav__link">
    <span class="md-ellipsis">
      Can I use TFMA to evaluate fairness or bias in my model?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-if-i-need-more-customization" class="md-nav__link">
    <span class="md-ellipsis">
      What if I need more customization?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-debugging-and-getting-help" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting, debugging, and getting help
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting, debugging, and getting help">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-dont-multiclassconfusionmatrix-metrics-match-binarized-confusionmatrix-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Why don't MultiClassConfusionMatrix metrics match binarized ConfusionMatrix metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-my-precision1-and-recall1-metrics-have-the-same-value" class="md-nav__link">
    <span class="md-ellipsis">
      Why do my precision@1 and recall@1 metrics have the same value?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-are-my-mean_label-and-mean_prediction-metrics-always-05" class="md-nav__link">
    <span class="md-ellipsis">
      Why are my mean_label and mean_prediction metrics always 0.5?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-interpret-the-multilabelconfusionmatrixplot" class="md-nav__link">
    <span class="md-ellipsis">
      How to interpret the MultiLabelConfusionMatrixPlot?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-do-i-get-an-error-about-prediction-key-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      Why do I get an error about prediction key not found?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/tensorflow/model-analysis/edit/master/docs/faq.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="tensorflow-model-analysis-frequently-asked-questions">Tensorflow Model Analysis Frequently Asked Questions<a class="headerlink" href="#tensorflow-model-analysis-frequently-asked-questions" title="Permanent link">&para;</a></h1>
<h2 id="general">General<a class="headerlink" href="#general" title="Permanent link">&para;</a></h2>
<h3 id="is-an-evalsavedmodel-still-required">Is an EvalSavedModel still required?<a class="headerlink" href="#is-an-evalsavedmodel-still-required" title="Permanent link">&para;</a></h3>
<p>Previously TFMA required all metrics to be stored within a tensorflow graph
using a special <code>EvalSavedModel</code>. Now, metrics can be computed outside of the TF
graph using <code>beam.CombineFn</code> implementations.</p>
<p>Some of the main differences are:</p>
<ul>
<li>An <code>EvalSavedModel</code> requires a special export from the trainer whereas a
    serving model can be used without any changes required to the training code.</li>
<li>When an <code>EvalSavedModel</code> is used, any metrics added at training time are
    automatically available at evaluation time. Without an <code>EvalSavedModel</code>
    these metrics must be re-added.<ul>
<li>The exception to this rule is if a keras model is used the metrics can
    also be added automatically because keras saves the metric information
    along side of the saved model.</li>
</ul>
</li>
</ul>
<p>NOTE: There are some metrics that are only supported using combiners (e.g.
multi-class/multi-label plots, aggregated multi-clas/multi-label metrics, etc).</p>
<h3 id="can-tfma-work-with-both-in-graph-metrics-and-external-metrics">Can TFMA work with both in-graph metrics and external metrics?<a class="headerlink" href="#can-tfma-work-with-both-in-graph-metrics-and-external-metrics" title="Permanent link">&para;</a></h3>
<p>TFMA allows a hybrid approach to be used where some metrics can be computed
in-graph where as others can be computed outside. If you currently have an
<code>EvalSavedModel</code> then you can continue to use it.</p>
<p>There are two cases:</p>
<ol>
<li>Use TFMA <code>EvalSavedModel</code> for both feature extraction and metric
    computations but also add additional combiner-based metrics. In this case
    you would get all the in-graph metrics from the <code>EvalSavedModel</code> along with
    any additional metrics from the combiner-based that might not have been
    previously supported.</li>
<li>Use TFMA <code>EvalSavedModel</code> for feature/prediction extraction but use
    combiner-based metrics for all metrics computations. This mode is useful if
    there are feature transformations present in the <code>EvalSavedModel</code> that you
    would like to use for slicing, but prefer to perform all metric computations
    outside the graph.</li>
</ol>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<h3 id="what-model-types-are-supported">What model types are supported?<a class="headerlink" href="#what-model-types-are-supported" title="Permanent link">&para;</a></h3>
<p>TFMA supports keras models, models based on generic TF2 signature APIs, as well
TF estimator based models (although depending on the use case the estimator
based models may require an <code>EvalSavedModel</code> to be used).</p>
<p>See <a href="../get_started/">get started</a> guide for the full list of model types
supported and any restrictions.</p>
<h3 id="how-do-i-setup-tfma-to-work-with-a-native-keras-based-model">How do I setup TFMA to work with a native keras based model?<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-a-native-keras-based-model" title="Permanent link">&para;</a></h3>
<p>The following is an example config for a keras model based on the following
assumptions:</p>
<ul>
<li>Saved model is for serving and uses the signature name <code>serving_default</code>
    (this can be changed using <code>model_specs[0].signature_name</code>).</li>
<li>Built in metrics from <code>model.compile(...)</code> should be evaluated (this can be
    disabled via <code>options.include_default_metric</code> within the
    <a href="../api_docs/python/tfma#tensorflow_model_analysis.EvalConfig">tfma.EvalConfig</a>).</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="s2">    label_key: &quot;&lt;label-key&gt;&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="s2">    example_weight_key: &quot;&lt;example-weight-key&gt;&quot;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="s2">  }</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="s2">    # Add metrics here. For example:</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="s2">    #  metrics { class_name: &quot;ConfusionMatrixPlot&quot; }</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="s2">    #  metrics { class_name: &quot;CalibrationPlot&quot; }</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="s2">  }</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about other types of metrics that
can be configured.</p>
<h3 id="how-do-i-setup-tfma-to-work-with-a-generic-tf2-signatures-based-model">How do I setup TFMA to work with a generic TF2 signatures based model?<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-a-generic-tf2-signatures-based-model" title="Permanent link">&para;</a></h3>
<p>The following is an example config for a generic TF2 model. Below,
<code>signature_name</code> is the name of the specific signature that should be used for
evaluation.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="s2">    signature_name: &quot;&lt;signature-name&gt;&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="s2">    label_key: &quot;&lt;label-key&gt;&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="s2">    example_weight_key: &quot;&lt;example-weight-key&gt;&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="s2">  }</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="s2">    # Add metrics here. For example:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="s2">    #  metrics { class_name: &quot;BinaryCrossentropy&quot; }</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="s2">    #  metrics { class_name: &quot;ConfusionMatrixPlot&quot; }</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="s2">    #  metrics { class_name: &quot;CalibrationPlot&quot; }</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="s2">  }</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about other types of metrics that
can be configured.</p>
<h3 id="how-do-i-setup-tfma-to-work-with-an-estimator-based-model">How do I setup TFMA to work with an estimator based model?<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-an-estimator-based-model" title="Permanent link">&para;</a></h3>
<p>In this case there are three choices.</p>
<p><strong>Option1: Use Serving Model</strong></p>
<p>If this option is used then any metrics added during training will NOT be
included in the evaluation.</p>
<p>The following is an example config assuming <code>serving_default</code> is the signature
name used:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="s2">    label_key: &quot;&lt;label-key&gt;&quot;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="s2">    example_weight_key: &quot;&lt;example-weight-key&gt;&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="s2">  }</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="s2">    # Add metrics here.</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="s2">  }</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about other types of metrics that
can be configured.</p>
<p><strong>Option2: Use EvalSavedModel along with additional combiner-based metrics</strong></p>
<p>In this case, use <code>EvalSavedModel</code> for both feature / prediction extraction and
evaluation and also add additional combiner based metrics.</p>
<p>The following is an example config:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="s2">    signature_name: &quot;eval&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="s2">  }</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="s2">    # Add metrics here.</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="s2">  }</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about other types of metrics that
can be configured and <a href="../eval_saved_model/">EvalSavedModel</a> for more information
about setting up the EvalSavedModel.</p>
<p><strong>Option3: Use EvalSavedModel Model only for Feature / Prediction Extraction</strong></p>
<p>Similar to option(2), but only use <code>EvalSavedModel</code> for feature / prediction
extraction. This option is useful if only external metrics are desired, but
there are feature transformations that you would like to slice on. Similar to
option (1) any metrics added during training will NOT be included in the
evaluation.</p>
<p>In this case the config is the same as above only <code>include_default_metrics</code> is
disabled.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="s2">    signature_name: &quot;eval&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="s2">  }</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="s2">    # Add metrics here.</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="s2">  }</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="s2">  options {</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="s2">    include_default_metrics { value: false }</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="s2">  }</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about other types of metrics that
can be configured and <a href="../eval_saved_model/">EvalSavedModel</a> for more information
about setting up the EvalSavedModel.</p>
<h3 id="how-do-i-setup-tfma-to-work-with-a-keras-model-to-estimator-based-model">How do I setup TFMA to work with a keras model-to-estimator based model?<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-a-keras-model-to-estimator-based-model" title="Permanent link">&para;</a></h3>
<p>The keras <code>model_to_estimator</code> setup is similar to the estimator confiugration.
However there are a few differences specific to how model to estimator works. In
particular, the model-to-esimtator returns its outputs in the form of a dict
where the dict key is the name of the last output layer in the associated keras
model (if no name is provided, keras will choose a default name for you such as
<code>dense_1</code> or <code>output_1</code>). From a TFMA perspective, this behavior is similar to
what would be output for a multi-output model even though the model to estimator
may only be for a single model. To account for this difference, an additional
step is required to setup the output name. However, the same three options apply
as estimator.</p>
<p>The following is an example of the changes required to an estimator based
config:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="s2">  ... as for estimator ...</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="s2">    output_names: [&quot;&lt;keras-output-layer&gt;&quot;]</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="s2">    # Add metrics here.</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="s2">  }</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="s2">  ... as for estimator ...</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<h3 id="how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-tfrecord-and-tfexample">How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (<code>TFRecord</code> and <code>tf.Example</code>)<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-tfrecord-and-tfexample" title="Permanent link">&para;</a></h3>
<p>In order to configure TFMA to work with pre-calculated predictions, the default
<code>tfma.PredictExtractor</code> must be disabled and the <code>tfma.InputExtractor</code> must be
configured to parse the predictions along with the other input features. This is
accomplished by configuring a <code>tfma.ModelSpec</code> with the name of the feature key
used for the predictions alongside of the labels and weights.</p>
<p>The following is an example setup:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">google.protobuf</span><span class="w"> </span><span class="kn">import</span> <span class="n">text_format</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="s2">  model_specs {</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="s2">    prediction_key: &quot;&lt;prediction-key&gt;&quot;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="s2">    label_key: &quot;&lt;label-key&gt;&quot;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="s2">    example_weight_key: &quot;&lt;example-weight-key&gt;&quot;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="s2">  }</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="s2">    # Add metrics here.</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="s2">  }</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">tfma</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>See <a href="../metrics/">metrics</a> for more information about metrics that can be
configured.</p>
<p>Note that altough a <code>tfma.ModelSpec</code> is being configured a model is not actually
being used (i.e. there is no <code>tfma.EvalSharedModel</code>). The call to run model
analysis might look as follows:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">eval_result</span> <span class="o">=</span> <span class="n">tfma</span><span class="o">.</span><span class="n">run_model_analysis</span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">eval_config</span><span class="o">=</span><span class="n">eval_config</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="c1"># This assumes your data is a TFRecords file containing records in the</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="c1"># tf.train.Example format.</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">data_location</span><span class="o">=</span><span class="s2">&quot;/path/to/file/containing/tfrecords&quot;</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;/path/for/metrics_for_slice_proto&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-pddataframe">How do I setup TFMA to work with pre-calculated (i.e. model-agnostic) predictions? (<code>pd.DataFrame</code>)<a class="headerlink" href="#how-do-i-setup-tfma-to-work-with-pre-calculated-ie-model-agnostic-predictions-pddataframe" title="Permanent link">&para;</a></h3>
<p>For small datasets that can fit in memory, an alternative to a <code>TFRecord</code> is a
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html"><code>pandas.DataFrame</code></a>s.
TFMA can operate on <code>pandas.DataFrame</code>s using the <code>tfma.analyze_raw_data</code> API.
For an explanation of <code>tfma.MetricsSpec</code> and <code>tfma.SlicingSpec</code>, see the
<a href="../setup/">setup</a> guide. See <a href="../metrics/">metrics</a> for more information about
metrics that can be configured.</p>
<p>The following is an example setup:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Run in a Jupyter Notebook.</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">df_data</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># your pd.DataFrame</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">eval_config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="s2">  model_specs {</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="s2">    label_key: &#39;label&#39;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="s2">    prediction_key: &#39;prediction&#39;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="s2">  }</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="s2">    metrics { class_name: &quot;AUC&quot; }</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="s2">    metrics { class_name: &quot;ConfusionMatrixPlot&quot; }</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="s2">  }</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="s2">  slicing_specs </span><span class="si">{}</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="s2">  slicing_specs {</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="s2">    feature_keys: &#39;language&#39;</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="s2">  }</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="n">eval_result</span> <span class="o">=</span> <span class="n">tfma</span><span class="o">.</span><span class="n">analyze_raw_data</span><span class="p">(</span><span class="n">df_data</span><span class="p">,</span> <span class="n">eval_config</span><span class="p">)</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="n">tfma</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">render_slicing_metrics</span><span class="p">(</span><span class="n">eval_result</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="metrics">Metrics<a class="headerlink" href="#metrics" title="Permanent link">&para;</a></h2>
<h3 id="what-types-of-metrics-are-supported">What types of metrics are supported?<a class="headerlink" href="#what-types-of-metrics-are-supported" title="Permanent link">&para;</a></h3>
<p>TFMA supports a wide variety of metrics including:</p>
<ul>
<li><a href="../metrics/#regression-metrics">regression metrics</a></li>
<li><a href="../metrics/#binary-classification-metrics">binary classification metrics</a></li>
<li><a href="../metrics/#multi-classmulti-label-classification-metrics">multi-class/multi-label classification metrics</a></li>
<li><a href="../metrics/#multi-classmulti-label-aggregate-metrics">micro average / macro average metrics</a></li>
<li><a href="../metrics/#query-ranking-based-metrics">query / ranking based metrics</a></li>
</ul>
<h3 id="are-metrics-from-multi-output-models-supported">Are metrics from multi-output models supported?<a class="headerlink" href="#are-metrics-from-multi-output-models-supported" title="Permanent link">&para;</a></h3>
<p>Yes. See <a href="../metrics/#multi-output-model-metrics">metrics</a> guide for more
details.</p>
<h3 id="are-metrics-from-multiple-models-supported">Are metrics from multiple-models supported?<a class="headerlink" href="#are-metrics-from-multiple-models-supported" title="Permanent link">&para;</a></h3>
<p>Yes. See <a href="../metrics/#multi-model-evaluation-metrics">metrics</a> guide for more
details.</p>
<h3 id="can-the-metric-settings-name-etc-be-customized">Can the metric settings (name, etc) be customized?<a class="headerlink" href="#can-the-metric-settings-name-etc-be-customized" title="Permanent link">&para;</a></h3>
<p>Yes. Metrics settings can be customized (e.g. setting specific thresholds, etc)
by adding <code>config</code> settings to the metric configuration. See
<a href="../metrics/#customizing-metric-settings">metrics</a> guide has more details.</p>
<h3 id="are-custom-metrics-supported">Are custom metrics supported?<a class="headerlink" href="#are-custom-metrics-supported" title="Permanent link">&para;</a></h3>
<p>Yes. Either by writing a custom <code>tf.keras.metrics.Metric</code> implementation or by
writing a custom <code>beam.CombineFn</code> implementation. The
<a href="../metrics/#customization">metrics</a> guide has more details.</p>
<h3 id="what-types-of-metrics-are-not-supported">What types of metrics are not supported?<a class="headerlink" href="#what-types-of-metrics-are-not-supported" title="Permanent link">&para;</a></h3>
<p>As long as your metric can be calculated using a <code>beam.CombineFn</code>, there are no
restrictions on the types of metrics that can be computed based on
<code>tfma.metrics.Metric</code>. If working with a metric derived from
<code>tf.keras.metrics.Metric</code> then the following criteria must be satisfied:</p>
<ul>
<li>It should be possible to compute sufficient statistics for the metric on
    each example independently, then combine these sufficient statistics by
    adding them across all the examples, and determine the metric value solely
    from these sufficient statistics.</li>
<li>For example, for accuracy the sufficient statistics are "total correct" and
    "total examples". It’s possible to compute these two numbers for individual
    examples, and add them up for a group of examples to get the right values
    for those examples. The final accuracy can be computed used "total correct /
    total examples".</li>
</ul>
<h2 id="add-ons">Add-ons<a class="headerlink" href="#add-ons" title="Permanent link">&para;</a></h2>
<h3 id="can-i-use-tfma-to-evaluate-fairness-or-bias-in-my-model">Can I use TFMA to evaluate fairness or bias in my model?<a class="headerlink" href="#can-i-use-tfma-to-evaluate-fairness-or-bias-in-my-model" title="Permanent link">&para;</a></h3>
<p>TFMA includes a
<a href="https://github.com/tensorflow/model-analysis/blob/master/tensorflow_model_analysis/addons/fairness/post_export_metrics/fairness_indicators.py">FairnessIndicators</a>
add-on that provides post-export metrics for evaluating the effects of
unintended bias in classification models.</p>
<h2 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">&para;</a></h2>
<h3 id="what-if-i-need-more-customization">What if I need more customization?<a class="headerlink" href="#what-if-i-need-more-customization" title="Permanent link">&para;</a></h3>
<p>TFMA is very flexibile and allows you to customize almost all parts of the
pipeline using custom <code>Extractors</code>, <code>Evaluators</code>, and/or <code>Writers</code>. These
abstrations are discusssed in more detail in the <a href="../architecture/">architecture</a>
document.</p>
<h2 id="troubleshooting-debugging-and-getting-help">Troubleshooting, debugging, and getting help<a class="headerlink" href="#troubleshooting-debugging-and-getting-help" title="Permanent link">&para;</a></h2>
<h3 id="why-dont-multiclassconfusionmatrix-metrics-match-binarized-confusionmatrix-metrics">Why don't MultiClassConfusionMatrix metrics match binarized ConfusionMatrix metrics<a class="headerlink" href="#why-dont-multiclassconfusionmatrix-metrics-match-binarized-confusionmatrix-metrics" title="Permanent link">&para;</a></h3>
<p>These are actually different calculations. Binarization performs a comparison
for each class ID independently (i.e. the prediction for each class is compared
separately against the thresholds provided). In this case it is possible for two
or more classes to all indicate that they matched the prediction because their
predicted value was greater than the threshold (this will be even more apparant
at lower thresholds). In the case of the multiclass confusion matrix, there is
still only one true predicted value and it either matches the actual value or it
doesn't. The threshold is only used to force a prediction to match no class if
it is less than the threshold. The higher the threshold the harder for a
binarized class's prediction to match. Likewise the lower the threshold the
easier it is for a binarized class's predictions to match. The means that at
thresholds &gt; 0.5 the binarized values and the multiclass matrix values will be
closer aligned and at thresholds &lt; 0.5 they will be farther apart.</p>
<p>For example, let's say we have 10 classes where class 2 was predicted with a
probability of 0.8, but the actual class was class 1 which had a probability of
0.15. If you binarize on class 1 and use a threshold of 0.1, then class 1 will
be considered correct (0.15 &gt; 0.1) so it will be counted as a TP, However, for
the multiclass case, class 2 will be considered correct (0.8 &gt; 0.1) and since
class 1 was the actual, this will be counted as a FN. Because at lower
thresholds more values will be considered positives, in general there will be
higher TP and FP counts for binarized confusion matrix than for the multiclass
confusion matrix, and similarly lower TN and FN.</p>
<p>The following is an example of observed differences between
MultiClassConfusionMatrixAtThresholds and the corresponding counts from
binarization of one of the classes.</p>
<p><img alt="MultiClassConfusionMatrixAtThresholds vs Binarized" src="../images/multi_class_vs_binarized_metric_calculations.png" /></p>
<h3 id="why-do-my-precision1-and-recall1-metrics-have-the-same-value">Why do my precision@1 and recall@1 metrics have the same value?<a class="headerlink" href="#why-do-my-precision1-and-recall1-metrics-have-the-same-value" title="Permanent link">&para;</a></h3>
<p>At a top k value of 1 precision and recall are the same thing. Precision is
equal to <code>TP / (TP + FP)</code> and recall is equal to <code>TP / (TP + FN)</code>. The top
prediction is always positive and will either match or not match the label. In
other words, with <code>N</code> examples, <code>TP + FP = N</code>. However, if the label doesn't
match the top prediction, then this also implies a non-top k prediction was
matched and with top k set to 1, all non-top 1 predictions will be 0. This
implies FN must be <code>(N - TP)</code> or <code>N = TP + FN</code>. The end result is
<code>precision@1 = TP / N = recall@1</code>. Note that this only applies when there is a
single label per example, not for multi-label.</p>
<h3 id="why-are-my-mean_label-and-mean_prediction-metrics-always-05">Why are my mean_label and mean_prediction metrics always 0.5?<a class="headerlink" href="#why-are-my-mean_label-and-mean_prediction-metrics-always-05" title="Permanent link">&para;</a></h3>
<p>This is most likely caused because the metrics are configured for a binary
classification problem, but the model is outputing probabilities for both of the
classes instead of just one. This is common when
<a href="https://tensorflow.github.io/serving/guide/signature_defs/#classification-signaturedef">tensorflow's classification API</a>
is used. The solution is to choose the class that you would like the predictions
to be based on and then binarize on that class. For example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">eval_config</span> <span class="o">=</span> <span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="s2">  ...</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="s2">  metrics_specs {</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="s2">    binarize { class_ids: { values: [0] } }</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="s2">    metrics { class_name: &quot;MeanLabel&quot; }</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="s2">    metrics { class_name: &quot;MeanPrediction&quot; }</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="s2">    ...</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="s2">  }</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="s2">  ...</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">EvalConfig</span><span class="p">())</span>
</span></code></pre></div>
<p>Note: This applies to all metrics not just <code>mean_label</code> and <code>mean_prediction</code>.</p>
<h3 id="how-to-interpret-the-multilabelconfusionmatrixplot">How to interpret the MultiLabelConfusionMatrixPlot?<a class="headerlink" href="#how-to-interpret-the-multilabelconfusionmatrixplot" title="Permanent link">&para;</a></h3>
<p>Given a particular label, the <code>MultiLabelConfusionMatrixPlot</code> (and associated
<code>MultiLabelConfusionMatrix</code>) can be used to compare the outcomes of other labels
and their predictions when the chosen label was actually true. For example,
let's say that we have three classes <code>bird</code>, <code>plane</code>, and <code>superman</code> and we are
classifying pictures to indicate if they contain one or more of any of these
classes. The <code>MultiLabelConfusionMatrix</code> will compute the cartesian product of
each actual class against each other class (called the predicted class). Note
that while the pairing is <code>(actual, predicted)</code>, the <code>predicted</code> class does not
necessarily imply a positive prediction, it merely represents the predicted
column in the actual vs predicted matrix. For example, let's say we have
computed the following matrices:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>   (bird, bird)         -&gt;    { tp: 6, fp: 0, fn: 2, tn: 0}
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>   (bird, plane)        -&gt;    { tp: 2, fp: 2, fn: 2, tn: 2}
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>   (bird, superman)     -&gt;    { tp: 1, fp: 1, fn: 4, tn: 2}
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>   (plane, bird)        -&gt;    { tp: 3, fp: 1, fn: 1, tn: 3}
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>   (plane, plane)       -&gt;    { tp: 4, fp: 0, fn: 4, tn: 0}
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>   (plane, superman)    -&gt;    { tp: 1, fp: 3, fn: 3, tn: 1}
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>   (superman, bird)     -&gt;    { tp: 3, fp: 2, fn: 2, tn: 2}
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>   (superman, plane)    -&gt;    { tp: 2, fp: 3, fn: 2, tn: 2}
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>   (superman, superman) -&gt;    { tp: 4, fp: 0, fn: 5, tn: 0}
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>   num_examples: 20
</span></code></pre></div>
<p>The <code>MultiLabelConfusionMatrixPlot</code> has three ways to display this data. In all
cases the way to read the table is row by row from the perspective of the actual
class.</p>
<p>Note: Do NOT expect the counts to add up to the number of examples, these counts
are done across labels and since this is a multi-label problem, there will be
double counting.</p>
<p>1) Total Prediction Count</p>
<p>In this case, for a given row (i.e. actual class) what were the <code>TP + FP</code> counts
for the other classes. For the counts above, our display would be as follows:</p>
<div class="language-text highlight"><pre><span></span><code>            | Predicted bird | Predicted plane | Predicted superman
</code></pre></div>
<p>--------------- | -------------- | --------------- | ------------------
Actual bird     | 6              | 4               | 2
Actual plane    | 4              | 4               | 4
Actual superman | 5              | 5               | 4</p>
<p>When the pictures actually contained a <code>bird</code> we correctly predicted 6 of them.
At the same time we also predicted <code>plane</code> (either correctly or wrongly) 4 times
and <code>superman</code> (either correctly or wrongly) 2 times.</p>
<p>2) Incorrect Prediction Count</p>
<p>In this case, for a given row (i.e. actual class) what were the <code>FP</code> counts for
the other classes. For the counts above, our display would be as follows:</p>
<div class="language-text highlight"><pre><span></span><code>            | Predicted bird | Predicted plane | Predicted superman
</code></pre></div>
<p>--------------- | -------------- | --------------- | ------------------
Actual bird     | 0              | 2               | 1
Actual plane    | 1              | 0               | 3
Actual superman | 2              | 3               | 0</p>
<p>When the pictures actually contained a <code>bird</code> we incorrectly predicted <code>plane</code> 2
times and <code>superman</code> 1 times.</p>
<p>3) False Negative Count</p>
<p>In this case, for a given row (i.e. actual class) what were the <code>FN</code> counts for
the other classes. For the counts above, our display would be as follows:</p>
<div class="language-text highlight"><pre><span></span><code>            | Predicted bird | Predicted plane | Predicted superman
</code></pre></div>
<p>--------------- | -------------- | --------------- | ------------------
Actual bird     | 2              | 2               | 4
Actual plane    | 1              | 4               | 3
Actual superman | 2              | 2               | 5</p>
<p>When the pictures actually contained a <code>bird</code> we failed to predict it 2 times.
At the same time, we failed to predict <code>plane</code> 2 times and <code>superman</code> 4 times.</p>
<h3 id="why-do-i-get-an-error-about-prediction-key-not-found">Why do I get an error about prediction key not found?<a class="headerlink" href="#why-do-i-get-an-error-about-prediction-key-not-found" title="Permanent link">&para;</a></h3>
<p>Some model's output their prediction in the form of a dictionary. For example, a
TF estimator for binary classification problem outputs a dictionary containing
<code>probabilities</code>, <code>class_ids</code>, etc. In most cases TFMA has defaults for finding
commomly used key names such as <code>predictions</code>, <code>probabilities</code>, etc. However, if
your model is very customized it may output keys under names not known by TFMA.
In theses cases a <code>prediciton_key</code> setting must be added to the <code>tfma.ModelSpec</code>
to identify the name of the key the output is stored under.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "content.action.edit"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>